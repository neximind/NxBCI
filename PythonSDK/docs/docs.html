<!DOCTYPE html><html><head>
      <title>docs</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\Admin\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.18\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="nxbci-api-documentation">NxBCI API Documentation </h1>
<p>This document provides a comprehensive overview of the API for interacting with the EEG/EMG Device, including various modules and their functionalities.</p>
<hr>
<h2 id="modules">Modules </h2>
<ul>
<li><a href="#bluetoothcontroller"><code>BluetoothController</code></a></li>
<li><a href="#mqtt_receiver"><code>MQTT_Receiver</code></a></li>
<li><a href="#relay"><code>Relay</code></a></li>
<li><a href="#replay"><code>Replay</code></a></li>
<li><a href="#tcp_receiver"><code>TCP_Receiver</code></a></li>
</ul>
<hr>
<h1 id="bluetoothcontroller"><code>BluetoothController</code> </h1>
<p>A controller for managing Bluetooth Low Energy (BLE) device connections and data exchange. This document details how to use the class to interact with a BLE device.</p>
<h2 id="contents">Contents </h2>
<ol>
<li><a href="#overview--quick-start">Overview &amp; Quick Start</a></li>
<li><a href="#connection-management">Connection Management</a></li>
<li><a href="#device-information">Device Information</a></li>
<li><a href="#pose--temperature-data">Pose &amp; Temperature Data</a></li>
<li><a href="#device-configuration">Device Configuration</a></li>
</ol>
<hr>
<h2 id="overview--quick-start">Overview &amp; Quick Start </h2>
<p>The <code>BluetoothController</code> class encapsulates device scanning, connection, data I/O, and notification handling.</p>
<h3 id="core-features">Core Features </h3>
<ul>
<li>Automatically scans for and connects to a specified BLE device.</li>
<li>Reads essential device information like battery level and TF card storage.</li>
<li>Receives and parses real-time pose data (accelerometer, gyroscope, thermometer).</li>
<li>Configures device work modes (TF Card Storage, TCP, MQTT).</li>
<li>Sets device parameters like gain and sample rate.</li>
</ul>
<h3 id="quick-start-example">Quick Start Example </h3>
<blockquote>
<p>Using an <code>async with</code> statement is the recommended way to manage the controller's lifecycle, as it handles initialization and cleanup automatically.</p>
</blockquote>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-import">import</span> asyncio
<span class="token keyword keyword-import">import</span> logging
<span class="token keyword keyword-from">from</span> NxBCI<span class="token punctuation">.</span>BluetoothController <span class="token keyword keyword-import">import</span> BluetoothController

<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-def">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Instantiate the controller with the target device name</span>
    controller <span class="token operator">=</span> BluetoothController<span class="token punctuation">(</span>device_name<span class="token operator">=</span><span class="token string">"BLE_FOR_EEG"</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-try">try</span><span class="token punctuation">:</span>
        <span class="token comment"># 'async with' automatically calls initialize() and close()</span>
        <span class="token keyword keyword-async">async</span> <span class="token keyword keyword-with">with</span> controller<span class="token punctuation">:</span>
            <span class="token keyword keyword-if">if</span> <span class="token keyword keyword-not">not</span> controller<span class="token punctuation">.</span>bt_GetConnectionStatus<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"Failed to initialize controller."</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-return">return</span>

            <span class="token comment"># Get device gain</span>
            gain <span class="token operator">=</span> controller<span class="token punctuation">.</span>bt_GetGain<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Device Gain: </span><span class="token interpolation"><span class="token punctuation">{</span>gain<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

            <span class="token comment"># Get battery level</span>
            battery <span class="token operator">=</span> controller<span class="token punctuation">.</span>bt_GetBatteryLevel<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Battery Level: </span><span class="token interpolation"><span class="token punctuation">{</span>battery<span class="token punctuation">}</span></span><span class="token string">%"</span></span><span class="token punctuation">)</span>

            <span class="token comment"># Configure the pose data sample rate (how many data points to buffer)</span>
            controller<span class="token punctuation">.</span>pose_Config<span class="token punctuation">(</span>Sample_rate<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token comment"># Buffer 50 samples</span>

            <span class="token comment"># Loop to get data</span>
            <span class="token keyword keyword-for">for</span> _ <span class="token keyword keyword-in">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># Example: loop 10 times</span>
                <span class="token comment"># Get the latest pose data</span>
                pose_data <span class="token operator">=</span> controller<span class="token punctuation">.</span>pose_GetData<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Bluetooth will receive data from the device only when the TCP_Receiver is receiving data.</span>
                <span class="token keyword keyword-if">if</span> pose_data<span class="token punctuation">:</span>
                    <span class="token comment"># pose_data is a list of 7 deques for</span>
                    <span class="token comment"># Accel(X,Y,Z), Temp, Gyro(X,Y,Z)</span>
                    <span class="token comment"># Print the latest data point (index -1)</span>
                    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span>f"Accelerometer<span class="token punctuation">:</span> <span class="token punctuation">(</span>X<span class="token punctuation">:</span><span class="token punctuation">{</span>pose_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">.</span>2f<span class="token punctuation">}</span><span class="token punctuation">,</span>
                                            Y<span class="token punctuation">:</span><span class="token punctuation">{</span>pose_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">.</span>2f<span class="token punctuation">}</span><span class="token punctuation">,</span> 
                                            Z<span class="token punctuation">:</span><span class="token punctuation">{</span>pose_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">.</span>2f<span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">)</span>
                    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Temperature: </span><span class="token interpolation"><span class="token punctuation">{</span>pose_data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">°C"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span>f"Gyroscope<span class="token punctuation">:</span> <span class="token punctuation">(</span>X<span class="token punctuation">:</span><span class="token punctuation">{</span>pose_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">.</span>2f<span class="token punctuation">}</span><span class="token punctuation">,</span>
                                            Y<span class="token punctuation">:</span><span class="token punctuation">{</span>pose_data<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">.</span>2f<span class="token punctuation">}</span><span class="token punctuation">,</span> 
                                            Z<span class="token punctuation">:</span><span class="token punctuation">{</span>pose_data<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">.</span>2f<span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">)</span>
                <span class="token keyword keyword-await">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-except">except</span> Exception <span class="token keyword keyword-as">as</span> e<span class="token punctuation">:</span>
        logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"An error occurred: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword keyword-if">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(levelname)s: %(message)s'</span><span class="token punctuation">)</span>
    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><hr>
<h2 id="connection-management">Connection Management </h2>
<p>Interfaces for managing the BLE device connection lifecycle.</p>
<h3 id="__init__self-device_name-str--ble_for_eeg"><code>__init__(self, device_name: str = "BLE_FOR_EEG")</code> </h3>
<p>Initializes a new <code>BluetoothController</code> instance.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>device_name</code> (<code>str</code>): The name of the target BLE device to connect to. Defaults to <code>"BLE_FOR_EEG"</code>.</li>
</ul>
</li>
</ul>
<h3 id="async-def-initializeself---none"><code>async def initialize(self) -&gt; None</code> </h3>
<p>Initializes the controller by scanning for, connecting to, and fetching initial data from the device. This is called automatically when entering an <code>async with</code> block.</p>
<h3 id="async-def-closeself---none"><code>async def close(self) -&gt; None</code> </h3>
<p>Disconnects from the BLE device and cleans up resources. This is called automatically when exiting an <code>async with</code> block.</p>
<h3 id="async-def-bt_reconnectbluetoothself"><code>async def bt_ReconnectBluetooth(self)</code> </h3>
<p>Manually attempts to reconnect to the BLE device. This is useful if the connection was lost. If the device is already connected, this method does nothing.</p>
<h3 id="async-def-bt_setbluetoothtargetself-target-str"><code>async def bt_SetBluetoothTarget(self, target: str)</code> </h3>
<p>Switches the connection to a new target BLE device. This will disconnect from the current device (if any) and then initiate a new connection to the specified target.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>target</code> (<code>str</code>): The name of the new target device.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="device-information">Device Information </h2>
<p>Methods to retrieve status and configuration information from the device.</p>
<h3 id="def-bt_getconnectionstatusself---bool"><code>def bt_GetConnectionStatus(self) -&gt; bool</code> </h3>
<p>Checks the current connection status of the BLE device.</p>
<ul>
<li><strong>Returns</strong>: <code>bool</code> - <code>True</code> if connected, <code>False</code> otherwise.</li>
</ul>
<h3 id="def-bt_getdevicenameself---str"><code>def bt_GetDeviceName(self) -&gt; str</code> </h3>
<p>Gets the name of the currently connected BLE device.</p>
<ul>
<li><strong>Returns</strong>: <code>str</code> - The device name.</li>
</ul>
<h3 id="def-bt_getdeviceaddressself---str"><code>def bt_GetDeviceAddress(self) -&gt; str</code> </h3>
<p>Gets the MAC address of the currently connected BLE device.</p>
<ul>
<li><strong>Returns</strong>: <code>str</code> - The device's MAC address.</li>
</ul>
<h3 id="def-bt_getbatterylevelself---int"><code>def bt_GetBatteryLevel(self) -&gt; int</code> </h3>
<p>Gets the device's current battery level as a percentage.</p>
<ul>
<li><strong>Returns</strong>: <code>int</code> - The battery level percentage (0-100).</li>
</ul>
<h3 id="def-bt_getgainself---int"><code>def bt_GetGain(self) -&gt; int</code> </h3>
<p>Gets the device's current gain configuration.</p>
<ul>
<li><strong>Returns</strong>: <code>int</code> - Returns <code>100</code> or <code>1000</code>. Returns <code>0</code> if the gain has not yet been fetched from the device.</li>
</ul>
<h3 id="async-def-bt_getsamplerateself---int"><code>async def bt_GetSampleRate(self) -&gt; int</code> </h3>
<p>Gets the device's main data acquisition sample rate.</p>
<ul>
<li><strong>Returns</strong>: <code>int</code> - The current sample rate in Hz (e.g., 500, 1000, 2000, 4000).</li>
</ul>
<hr>
<h2 id="pose--temperature-data">Pose &amp; Temperature Data </h2>
<p>Interfaces for configuring and retrieving pose and temperature data from the MPU sensor.</p>
<h3 id="def-pose_configself-sample_rate-int"><code>def pose_Config(self, Sample_rate: int)</code> </h3>
<p>Sets the internal sample rate and buffer size for pose and temperature data. This determines the length of the deques returned by <code>pose_GetData</code>.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>Sample_rate</code> (<code>int</code>): The desired number of samples to buffer. The valid range is (0, 100].</li>
</ul>
</li>
</ul>
<h3 id="def-pose_getdataself---optionallistdeque"><code>def pose_GetData(self) -&gt; Optional[List[deque]]</code> </h3>
<p>Retrieves the buffered list of latest pose and temperature data.</p>
<ul>
<li><strong>Returns</strong>: <code>Optional[List[deque]]</code> - A list of 7 <code>deque</code> objects. Returns <code>None</code> if the Bluetooth is not connected or the buffer is not yet full.
<ul>
<li><strong>Deque Order</strong>:
<ol>
<li><code>deque[0]</code>: X-axis acceleration (g)</li>
<li><code>deque[1]</code>: Y-axis acceleration (g)</li>
<li><code>deque[2]</code>: Z-axis acceleration (g)</li>
<li><code>deque[3]</code>: Temperature (°C)</li>
<li><code>deque[4]</code>: X-axis angular velocity (°)</li>
<li><code>deque[5]</code>: Y-axis angular velocity (°)</li>
<li><code>deque[6]</code>: Z-axis angular velocity (°)</li>
</ol>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="device-configuration">Device Configuration </h2>
<p>Asynchronous methods for writing new configurations to the device.</p>
<h3 id="async-def-bt_setgainself-gain-int"><code>async def bt_SetGain(self, gain: int)</code> </h3>
<p>Sets the device's gain value.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>gain</code> (<code>int</code>): The gain value. <strong>Must</strong> be <code>100</code> or <code>1000</code>.</li>
</ul>
</li>
</ul>
<h3 id="async-def-bt_setsamplerateself-samplerate-int"><code>async def bt_SetSampleRate(self, sampleRate: int)</code> </h3>
<p>Sets the device's main data acquisition sample rate.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>sampleRate</code> (<code>int</code>): The sample rate in Hz. <strong>Must</strong> be one of: <code>500</code>, <code>1000</code>, <code>2000</code>, <code>4000</code>.</li>
</ul>
</li>
<li><strong>Raises</strong>:
<ul>
<li><code>ValueError</code>: If an unsupported <code>sampleRate</code> is provided.</li>
</ul>
</li>
</ul>
<h3 id="async-def-bt_settfcardstoragemodeself"><code>async def bt_SetTFcardStorageMode(self)</code> </h3>
<p>Sets the device's work mode to "TF Card Storage". The device will store collected data directly on its TF card.</p>
<h3 id="async-def-bt_settcpmodeself-wifi_name-str-password-str"><code>async def bt_SetTCPMode(self, wifi_name: str, password: str)</code> </h3>
<p>Sets the device's work mode to "TCP Transport Mode", sending data over Wi-Fi.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>wifi_name</code> (<code>str</code>): The Wi-Fi network name (SSID) for the device to connect to.</li>
<li><code>password</code> (<code>str</code>): The Wi-Fi network password.</li>
</ul>
</li>
</ul>
<h3 id="async-def-bt_setmqttmodeself-mqtt_uri-str-port-int"><code>async def bt_SetMQTTMode(self, MQTT_URI: str, port: int)</code> </h3>
<p>Sets the device's work mode to "MQTT Transport Mode".</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>MQTT_URI</code> (<code>str</code>): The address of the MQTT broker.</li>
<li><code>port</code> (<code>int</code>): The port of the MQTT broker.</li>
</ul>
</li>
</ul>
<hr>
<hr>
<h1 id="mqtt_receiver"><code>MQTT_Receiver</code> </h1>
<p>A thread-safe class to receive and process data via the MQTT protocol. It handles the connection lifecycle, subscription, and data processing in a background thread, providing a simple and robust interface.</p>
<h2 id="table-of-contents">Table of Contents </h2>
<ol>
<li><a href="#overview--quick-start-1">Overview &amp; Quick Start</a></li>
<li><a href="#lifecycle-methods">Lifecycle Methods</a></li>
<li><a href="#status--data-access">Status &amp; Data Access</a></li>
</ol>
<hr>
<h2 id="overview--quick-start-1">Overview &amp; Quick Start </h2>
<p>This class leverages the <code>paho-mqtt</code> library to manage a persistent connection to an MQTT broker. It automatically handles reconnections in its own network thread, allowing your main application to remain focused on its primary tasks.</p>
<h3 id="quick-start-example-1">Quick Start Example </h3>
<blockquote>
<p>This example demonstrates the standard workflow: initialize, start, poll for data in a loop, and finally, stop the client gracefully.</p>
</blockquote>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-import">import</span> logging
<span class="token keyword keyword-import">import</span> time
<span class="token keyword keyword-from">from</span> NxBCI<span class="token punctuation">.</span>MQTT_Receiver <span class="token keyword keyword-import">import</span> MQTT_Receiver

<span class="token comment"># Configure logging to see status messages from the receiver</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span> 
                    <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(levelname)s - %(message)s'</span><span class="token punctuation">)</span>

<span class="token comment"># 1. Initialize the receiver (this does not connect yet)</span>
receiver <span class="token operator">=</span> MQTT_Receiver<span class="token punctuation">(</span>Ip<span class="token operator">=</span><span class="token string">"MQTT broker IP"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">1883</span><span class="token punctuation">,</span> topic<span class="token operator">=</span><span class="token string">"esp32-pub-message"</span><span class="token punctuation">)</span>

<span class="token comment"># 2. Start the connection and background network loop</span>
receiver<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword keyword-try">try</span><span class="token punctuation">:</span>
    <span class="token keyword keyword-while">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token comment"># 3. Safely check the connection status</span>
        <span class="token keyword keyword-if">if</span> receiver<span class="token punctuation">.</span>is_connected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 4. Safely get a copy of the latest EEG data</span>
            data <span class="token operator">=</span> receiver<span class="token punctuation">.</span>get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-if">if</span> data <span class="token keyword keyword-and">and</span> data<span class="token punctuation">:</span>
                <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"MQTT Connected. Last value on Ch0: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">list</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string"> mV"</span></span><span class="token punctuation">)</span>
            <span class="token keyword keyword-else">else</span><span class="token punctuation">:</span>
                <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"MQTT Connected, but no data received yet."</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-else">else</span><span class="token punctuation">:</span>
            <span class="token comment"># The Paho-MQTT client handles reconnections automatically</span>
            <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"MQTT Disconnected. Waiting for automatic reconnect..."</span><span class="token punctuation">)</span>

<span class="token keyword keyword-except">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Program interrupted by user."</span><span class="token punctuation">)</span>
<span class="token keyword keyword-finally">finally</span><span class="token punctuation">:</span>
    <span class="token comment"># 5. Stop the client and disconnect cleanly</span>
    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Stopping MQTT receiver..."</span><span class="token punctuation">)</span>
    receiver<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Receiver stopped."</span><span class="token punctuation">)</span>
</code></pre><hr>
<h2 id="lifecycle-methods">Lifecycle Methods </h2>
<p>These methods control the operational state of the MQTT client.</p>
<h3 id="__init__self-channels-int--16-sample_rate-int--500-duration-int--4-ip-str--your-mqtt-broker-ip-port-int--1883-topic-str--esp32-pub-message"><code>__init__(self, channels: int = 16, sample_rate: int = 500, duration: int = 4, Ip: str = "your MQTT Broker IP", port: int = 1883, topic: str = "esp32-pub-message")</code> </h3>
<p>Initializes the <code>MQTT_Receiver</code>'s configuration. This method only sets up the object's state and does not initiate any network activity.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>channels</code> (<code>int</code>): The number of EEG data channels to process. Defaults to <code>16</code>.</li>
<li><code>sample_rate</code> (<code>int</code>): The sampling rate (Hz) of the data, used to calculate buffer size. Defaults to <code>500</code>.</li>
<li><code>duration</code> (<code>int</code>): The duration in seconds of data to store in each channel's buffer. Defaults to <code>4</code>.</li>
<li><code>Ip</code> (<code>str</code>): The IP address or hostname of the MQTT broker.</li>
<li><code>port</code> (<code>int</code>): The network port of the MQTT broker. Defaults to <code>1883</code>.</li>
<li><code>topic</code> (<code>str</code>): The MQTT topic to subscribe to for data. Defaults to <code>esp32-pub-message</code>.</li>
</ul>
</li>
</ul>
<h3 id="startself"><code>start(self)</code> </h3>
<p>Connects to the MQTT broker and starts the background network loop (<code>loop_start</code>). The loop runs in a separate thread, handling network traffic, callbacks, and automatic reconnections. This method is non-blocking.</p>
<h3 id="stopself"><code>stop(self)</code> </h3>
<p>Stops the network loop and disconnects gracefully from the MQTT broker. This ensures a clean shutdown.</p>
<hr>
<h2 id="status--data-access">Status &amp; Data Access </h2>
<p>These methods provide thread-safe access to the receiver's current state and the data it has collected.</p>
<h3 id="is_connectedself---bool"><code>is_connected(self) -&gt; bool</code> </h3>
<p>Checks if the client is currently connected to the MQTT broker.</p>
<ul>
<li><strong>Returns</strong>: <code>bool</code> - <code>True</code> if the client is connected, <code>False</code> otherwise.</li>
</ul>
<h3 id="get_dataself---listdequefloat"><code>get_data(self) -&gt; List[Deque[float]]</code> </h3>
<p>Returns a shallow copy of all channel data queues. Returning a copy prevents potential thread-safety issues if your application iterates over the data while the network thread is simultaneously modifying it.</p>
<ul>
<li><strong>Returns</strong>: <code>List[Deque[float]]</code> - A list of deques. Each deque contains the buffered data for a single channel, converted to millivolts (mV).</li>
</ul>
<h3 id="def-pose_getdataself---optionallistdeque-1"><code>def pose_GetData(self) -&gt; Optional[List[deque]]</code> </h3>
<p>Retrieves the buffered list of latest pose and temperature data.</p>
<ul>
<li><strong>Returns</strong>: <code>Optional[List[deque]]</code> - A list of 7 <code>deque</code> objects. Returns <code>None</code> if the MQTT connection is not connected or the mpu buffer is empty .
<ul>
<li><strong>Deque Order</strong>:
<ol>
<li><code>deque[0]</code>: X-axis acceleration (g)</li>
<li><code>deque[1]</code>: Y-axis acceleration (g)</li>
<li><code>deque[2]</code>: Z-axis acceleration (g)</li>
<li><code>deque[3]</code>: Temperature (°C)</li>
<li><code>deque[4]</code>: X-axis angular velocity (°)</li>
<li><code>deque[5]</code>: Y-axis angular velocity (°)</li>
<li><code>deque[6]</code>: Z-axis angular velocity (°)</li>
</ol>
</li>
</ul>
</li>
</ul>
<hr>
<hr>
<h1 id="relay"><code>Relay</code> </h1>
<p>A class for relaying data to a cloud-based MQTT broker. It handles connection and data publishing with a simple interface.</p>
<h2 id="table-of-contents-1">Table of Contents </h2>
<ol>
<li><a href="#overview--quick-start-2">Overview &amp; Quick Start</a></li>
<li><a href="#core-methods">Core Methods</a></li>
<li><a href="#attributes--status">Attributes &amp; Status</a></li>
</ol>
<hr>
<h2 id="overview--quick-start-2">Overview &amp; Quick Start </h2>
<p>The <code>Relay</code> class is designed to send data to a remote MQTT broker. Upon initialization, it immediately attempts to connect to the specified broker and starts a background network loop. The main interaction with the class involves creating an instance and then calling the <code>relay_data()</code> method whenever you need to publish a message.</p>
<h3 id="quick-start-example-2">Quick Start Example </h3>
<blockquote>
<p>This example demonstrates how to set up the relay and publish data in a loop.</p>
</blockquote>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-import">import</span> logging
<span class="token keyword keyword-import">import</span> time
<span class="token keyword keyword-import">import</span> json
<span class="token keyword keyword-from">from</span> NxBCI<span class="token punctuation">.</span>Ralay_EMQX <span class="token keyword keyword-import">import</span> Relay <span class="token comment"># Replace with the actual module name</span>

<span class="token comment"># Configure logging to see status messages</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(levelname)s - %(message)s'</span><span class="token punctuation">)</span>

<span class="token comment"># 1. Initialize the Relay. It will attempt to connect immediately.</span>
<span class="token comment">#    Replace with your actual broker details and credentials.</span>
cloud_relay <span class="token operator">=</span> Relay<span class="token punctuation">(</span>
    cloud_broker_address<span class="token operator">=</span><span class="token string">"your_broker_address.com"</span><span class="token punctuation">,</span>
    cloud_port<span class="token operator">=</span><span class="token number">1883</span><span class="token punctuation">,</span>
    cloud_topic<span class="token operator">=</span><span class="token string">"your/topic"</span><span class="token punctuation">,</span>
    client_id<span class="token operator">=</span><span class="token string">"local_relay_client_01"</span><span class="token punctuation">,</span>
    username<span class="token operator">=</span><span class="token string">"your_username"</span><span class="token punctuation">,</span>
    password<span class="token operator">=</span><span class="token string">"your_password"</span>
<span class="token punctuation">)</span>

<span class="token comment"># Give the client a moment to establish the connection</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> 

<span class="token keyword keyword-try">try</span><span class="token punctuation">:</span>
    <span class="token keyword keyword-for">for</span> i <span class="token keyword keyword-in">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 2. Check the connection status before attempting to send data</span>
        <span class="token keyword keyword-if">if</span> cloud_relay<span class="token punctuation">.</span>isConnected<span class="token punctuation">:</span>
            <span class="token comment"># 3. Relay data</span>
            payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"message_id"</span><span class="token punctuation">:</span> i<span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token string">"some_data"</span><span class="token punctuation">}</span>
            <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Relaying message: </span><span class="token interpolation"><span class="token punctuation">{</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            cloud_relay<span class="token punctuation">.</span>relay_data<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-else">else</span><span class="token punctuation">:</span>
            <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Relay is not connected. Waiting for connection..."</span><span class="token punctuation">)</span>
        
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword keyword-finally">finally</span><span class="token punctuation">:</span>
    <span class="token comment"># Although the class doesn't have a stop() method, this shows a complete lifecycle.</span>
    <span class="token comment"># The background thread is a daemon, so it will exit when the main program does.</span>
    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Program finished."</span><span class="token punctuation">)</span>
</code></pre><hr>
<h2 id="core-methods">Core Methods </h2>
<h3 id="__init__self-cloud_broker_address-cloud_port1883-cloud_topic-client_id-username-password"><code>__init__(self, cloud_broker_address='', cloud_port=1883, cloud_topic='', client_id='', username='', password='')</code> </h3>
<p>Initializes the <code>Relay</code> object and <strong>immediately attempts to connect</strong> to the MQTT broker in the background.</p>
<ul>
<li><strong>Note</strong>: This constructor starts a background network thread (<code>loop_start</code>). You do not need to call a separate <code>start</code> or <code>connect</code> method.</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>cloud_broker_address</code> (<code>str</code>): The IP address or hostname of the cloud MQTT broker.</li>
<li><code>cloud_port</code> (<code>int</code>): The network port of the broker. Defaults to <code>1883</code>. If set to <code>8883</code>, TLS/SSL is automatically enabled.</li>
<li><code>cloud_topic</code> (<code>str</code>): The default MQTT topic to publish data to.</li>
<li><code>client_id</code> (<code>str</code>): A unique client ID for the MQTT connection.</li>
<li><code>username</code> (<code>str</code>): The username for authenticating with the broker.</li>
<li><code>password</code> (<code>str</code>): The password for authenticating with the broker.</li>
</ul>
</li>
<li><strong>Logs</strong>:
<ul>
<li>Logs an error if the connection is refused or another exception occurs during initialization.</li>
</ul>
</li>
</ul>
<h3 id="relay_dataself-data"><code>relay_data(self, data)</code> </h3>
<p>Publishes a message to the MQTT topic specified during initialization.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>data</code> (<code>str</code> or <code>bytes</code>): The data payload to publish. The method internally converts it to a string (<code>str(data)</code>) before sending.</li>
</ul>
</li>
<li><strong>Logs</strong>:
<ul>
<li>Logs an error message if publishing the message fails (i.e., the status code from the publish call is not 0).</li>
</ul>
</li>
</ul>
<hr>
<h2 id="attributes--status">Attributes &amp; Status </h2>
<h3 id="isconnected"><code>isConnected</code> </h3>
<p>A boolean flag indicating the current connection status to the MQTT broker.</p>
<ul>
<li><strong>Type</strong>: <code>bool</code></li>
<li><strong>Details</strong>: This flag is set to <code>True</code> within the <code>on_connect</code> callback when a successful connection is established and <code>False</code> on failure or disconnection.</li>
</ul>
<h3 id="configuration-attributes">Configuration Attributes </h3>
<p>The parameters passed to the <code>__init__</code> method are stored as public attributes for reference:</p>
<ul>
<li><code>cloud_broker_address</code> (<code>str</code>)</li>
<li><code>cloud_port</code> (<code>int</code>)</li>
<li><code>cloud_topic</code> (<code>str</code>)</li>
<li><code>client_id</code> (<code>str</code>)</li>
<li><code>username</code> (<code>str</code>)</li>
<li><code>password</code> (<code>str</code>)</li>
<li><code>client</code> (<code>mqtt_client.Client</code>): The underlying Paho-MQTT client instance.</li>
</ul>
<hr>
<hr>
<h1 id="replay"><code>Replay</code> </h1>
<p>A thread-safe class for replaying data from a binary file to simulate a live data feed. It can also be used to load entire datasets into memory for analysis.</p>
<h2 id="table-of-contents-2">Table of Contents </h2>
<ol>
<li><a href="#overview--modes-of-operation">Overview &amp; Modes of Operation</a></li>
<li><a href="#lifecycle--context-manager">Lifecycle &amp; Context Manager</a></li>
<li><a href="#playback-control">Playback Control</a></li>
<li><a href="#data-loading-load-mode">Data Loading (Load Mode)</a></li>
<li><a href="#data-retrieval">Data Retrieval</a></li>
<li><a href="#status-checks">Status Checks</a></li>
</ol>
<hr>
<h2 id="overview--modes-of-operation">Overview &amp; Modes of Operation </h2>
<p>This class is designed to work in two distinct modes, making it a versatile tool for both testing real-time applications and performing offline data analysis.</p>
<ol>
<li>
<p><strong>Playback Mode</strong>: A background thread reads data samples from the file and "plays" them into a buffer at a specified sample rate. This perfectly simulates a live data source like a <code>TCP_Receiver</code> or <code>MQTT_Receiver</code>, making it ideal for testing data processing and visualization pipelines without a physical device.</p>
</li>
<li>
<p><strong>Load Mode</strong>: The entire binary file is read and parsed into memory. This allows for quick, random access to any part of the dataset, which is useful for analysis, feature extraction, or training machine learning models.</p>
</li>
</ol>
<h3 id="quick-start-playback-mode">Quick Start (Playback Mode) </h3>
<blockquote>
<p>Using the class as a context manager (<code>with Replay(...) as ...</code>) is strongly recommended to ensure that file resources are properly managed and closed.</p>
</blockquote>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-import">import</span> time
<span class="token keyword keyword-import">import</span> logging
<span class="token keyword keyword-from">from</span> NxBCI<span class="token punctuation">.</span>Replay <span class="token keyword keyword-import">import</span> Replay
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(message)s'</span><span class="token punctuation">)</span>

<span class="token comment"># Use 'with' to ensure the file is closed automatically</span>
<span class="token keyword keyword-with">with</span> Replay<span class="token punctuation">(</span>FilePath<span class="token operator">=</span><span class="token string">'YOUR_DATA.BIN'</span><span class="token punctuation">,</span> sample_rate<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> replayer<span class="token punctuation">:</span>
    <span class="token comment"># Start the background playback thread</span>
    replayer<span class="token punctuation">.</span>start_playback<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-for">for</span> _ <span class="token keyword keyword-in">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment"># Get the current playback buffer (last ~4 seconds of data)</span>
        data_buffer <span class="token operator">=</span> replayer<span class="token punctuation">.</span>get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-if">if</span> data_buffer <span class="token keyword keyword-and">and</span> data_buffer<span class="token punctuation">:</span>
            <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Playback is running. Buffer for Ch0 has </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>data_buffer<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> samples."</span></span><span class="token punctuation">)</span>
            
<span class="token keyword keyword-with">with</span> Replay<span class="token punctuation">(</span>FilePath<span class="token operator">=</span><span class="token string">'YOUR_DATA.BIN'</span><span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> replayer<span class="token punctuation">:</span>
    <span class="token comment"># Load the entire file into memory (this is a blocking call)</span>
    replayer<span class="token punctuation">.</span>load_all_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"File loaded. Total samples: </span><span class="token interpolation"><span class="token punctuation">{</span>replayer<span class="token punctuation">.</span>get_total_samples<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># Get a specific segment of the data</span>
    segment <span class="token operator">=</span> replayer<span class="token punctuation">.</span>get_segment<span class="token punctuation">(</span>start_sample<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> end_sample<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Retrieved a segment with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>segment<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> samples for Channel 0."</span></span><span class="token punctuation">)</span>

</code></pre><hr>
<h2 id="lifecycle--context-manager">Lifecycle &amp; Context Manager </h2>
<h3 id="__init__self-filepath-str-channels-int--16-sample_rate-int--500-duration-int--4-isloop-bool--false"><code>__init__(self, FilePath: str, channels: int = 16, sample_rate: int = 500, duration: int = 4, isLoop: bool = False)</code> </h3>
<p>Initializes the Replay object. This is a lightweight operation that only sets configuration and does not perform file I/O.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>FilePath</code> (<code>str</code>): The path to the binary data file.</li>
<li><code>channels</code> (<code>int</code>): The number of data channels recorded in the file. Defaults to <code>16</code>.</li>
<li><code>sample_rate</code> (<code>int</code>): The playback speed in samples per second (Hz). Defaults to <code>500</code>.</li>
<li><code>duration</code> (<code>int</code>): For playback mode, the duration in seconds of data to keep in the live buffer. Defaults to <code>4</code>.</li>
<li><code>isLoop</code> (<code>bool</code>): If <code>True</code>, playback will loop continuously from the beginning after reaching the end. Defaults to <code>False</code>.</li>
</ul>
</li>
<li><strong>Raises</strong>:
<ul>
<li><code>FileNotFoundError</code>: If the <code>FilePath</code> does not exist.</li>
</ul>
</li>
</ul>
<h3 id="__enter__self--__exit__self-"><code>__enter__(self)</code> / <code>__exit__(self, ...)</code> </h3>
<p>Implements the context manager protocol. The <code>__enter__</code> method opens the file and memory-maps it. The <code>__exit__</code> method ensures that the <code>stop()</code> method is called and all file resources are closed, even if errors occur.</p>
<hr>
<h2 id="playback-control">Playback Control </h2>
<p>These methods control the background playback thread. They automatically trigger <code>load_all_data()</code> if the data isn't already in memory.</p>
<h3 id="start_playbackself"><code>start_playback(self)</code> </h3>
<p>An alias for <code>restart_playback()</code>. Starts or restarts the playback from the beginning of the file.</p>
<h3 id="restart_playbackself"><code>restart_playback(self)</code> </h3>
<p>Stops any active playback and restarts it from the very beginning of the file (sample 0).</p>
<h3 id="play_fromself-start_sample-int"><code>play_from(self, start_sample: int)</code> </h3>
<p>Starts playback from a specific sample index and continues until the end of the file (or loops if <code>isLoop</code> is <code>True</code>).</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>start_sample</code> (<code>int</code>): The sample index (zero-based) to begin playing from.</li>
</ul>
</li>
</ul>
<h3 id="play_segmentself-start_sample-int-end_sample-int"><code>play_segment(self, start_sample: int, end_sample: int)</code> </h3>
<p>Plays only a specific segment of the data file, then stops automatically. The <code>isLoop</code> setting is ignored.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>start_sample</code> (<code>int</code>): The starting sample index of the segment.</li>
<li><code>end_sample</code> (<code>int</code>): The ending sample index of the segment (exclusive).</li>
</ul>
</li>
</ul>
<h3 id="stopself-1"><code>stop(self)</code> </h3>
<p>Stops the background playback thread if it is running. This is called automatically when exiting a <code>with</code> block.</p>
<hr>
<h2 id="data-loading-load-mode">Data Loading (Load Mode) </h2>
<h3 id="load_all_dataself"><code>load_all_data(self)</code> </h3>
<p>Loads the entire file into an in-memory cache. This is a blocking, one-time operation. It is required before using methods like <code>get_full_dataset()</code> or <code>get_segment()</code>.</p>
<hr>
<h2 id="data-retrieval">Data Retrieval </h2>
<h3 id="get_dataself---listdequefloat-1"><code>get_data(self) -&gt; List[Deque[float]]</code> </h3>
<p><strong>For Playback Mode.</strong> Returns a copy of the current playback data buffers (deques). This is the primary method for accessing data during a real-time playback simulation.</p>
<ul>
<li><strong>Returns</strong>: <code>List[Deque[float]]</code> - A list of deques, one for each channel, containing the most recent data samples.</li>
</ul>
<h3 id="get_full_datasetself---listlistfloat"><code>get_full_dataset(self) -&gt; List[List[float]]</code> </h3>
<p><strong>For Load Mode.</strong> Returns the entire dataset as a list of lists. Requires <code>load_all_data()</code> to have been called.</p>
<ul>
<li><strong>Returns</strong>: <code>List[List[float]]</code> - A list where each inner list contains all samples for a single channel.</li>
</ul>
<h3 id="get_segmentself-start_sample-int-end_sample-int---listlistfloat"><code>get_segment(self, start_sample: int, end_sample: int) -&gt; List[List[float]]</code> </h3>
<p><strong>For Load Mode.</strong> Returns a specific slice of the dataset. Requires <code>load_all_data()</code> to have been called.</p>
<ul>
<li><strong>Returns</strong>: <code>List[List[float]]</code> - A list containing the requested segment for each channel.</li>
</ul>
<h3 id="get_total_samplesself---int"><code>get_total_samples(self) -&gt; int</code> </h3>
<p><strong>For Load Mode.</strong> Returns the total number of samples detected in the file. Requires <code>load_all_data()</code> to have been called.</p>
<h3 id="def-pose_getdataself---optionallistdeque-2"><code>def pose_GetData(self) -&gt; Optional[List[deque]]</code> </h3>
<p>Retrieves the buffered list of latest pose and temperature data.</p>
<ul>
<li><strong>Returns</strong>: <code>Optional[List[deque]]</code> - A list of 7 <code>deque</code> objects. Returns <code>None</code> if the playback thread is not running or the MPU buffer is empty .
<ul>
<li><strong>Deque Order</strong>:
<ol>
<li><code>deque[0]</code>: X-axis acceleration (g)</li>
<li><code>deque[1]</code>: Y-axis acceleration (g)</li>
<li><code>deque[2]</code>: Z-axis acceleration (g)</li>
<li><code>deque[3]</code>: Temperature (°C)</li>
<li><code>deque[4]</code>: X-axis angular velocity (°)</li>
<li><code>deque[5]</code>: Y-axis angular velocity (°)</li>
<li><code>deque[6]</code>: Z-axis angular velocity (°)</li>
</ol>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="status-checks">Status Checks </h2>
<h3 id="is_runningself---bool"><code>is_running(self) -&gt; bool</code> </h3>
<p>Checks if the playback thread is currently active and running.</p>
<ul>
<li><strong>Returns</strong>: <code>bool</code> - <code>True</code> if playback is in progress, <code>False</code> otherwise.</li>
</ul>
<hr>
<hr>
<h1 id="tcp_receiver"><code>TCP_Receiver</code> </h1>
<p>A thread-safe TCP receiver designed for continuously acquiring data streams from a device. It uses a background worker thread to automatically handle connections, data reception, and reconnections.</p>
<h2 id="table-of-contents-3">Table of Contents </h2>
<ol>
<li><a href="#overview--quick-start-3">Overview &amp; Quick Start</a></li>
<li><a href="#lifecycle-methods-1">Lifecycle Methods</a></li>
<li><a href="#status--data-access-1">Status &amp; Data Access</a></li>
</ol>
<hr>
<h2 id="overview--quick-start-3">Overview &amp; Quick Start </h2>
<p>This class provides a robust solution for handling TCP data streams in a separate thread, ensuring your main application remains responsive. All public methods are thread-safe.</p>
<h3 id="quick-start-example-3">Quick Start Example </h3>
<blockquote>
<p>The following example demonstrates how to initialize, start, and interact with the <code>TCP_Receiver</code>.</p>
</blockquote>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-import">import</span> logging
<span class="token keyword keyword-import">import</span> time
<span class="token keyword keyword-from">from</span> NxBCI<span class="token punctuation">.</span>TCP_Receiver <span class="token keyword keyword-import">import</span> TCP_Receiver

<span class="token comment"># It's recommended to configure logging in your main script</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(levelname)s - %(message)s'</span><span class="token punctuation">)</span>

<span class="token comment"># 1. Initialize the receiver with target IP and parameters</span>
receiver <span class="token operator">=</span> TCP_Receiver<span class="token punctuation">(</span>channels<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> sample_rate<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> Ip<span class="token operator">=</span><span class="token string">"192.168.4.1"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">)</span>

<span class="token comment"># 2. Start the background worker thread</span>
receiver<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword keyword-try">try</span><span class="token punctuation">:</span>
    <span class="token keyword keyword-while">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token comment"># 3. Safely check the connection status</span>
        <span class="token keyword keyword-if">if</span> receiver<span class="token punctuation">.</span>is_connected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 4. Safely get a copy of the latest data</span>
            latest_data_queues <span class="token operator">=</span> receiver<span class="token punctuation">.</span>get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-if">if</span> latest_data_queues <span class="token keyword keyword-and">and</span> latest_data_queues<span class="token punctuation">:</span>
                <span class="token comment"># Access the latest value from the first channel's queue</span>
                <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Connection is ON. Channel 0 latest value: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">list</span><span class="token punctuation">(</span>latest_data_queues<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword keyword-else">else</span><span class="token punctuation">:</span>
                <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Connection is ON, but no data has been received yet."</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-else">else</span><span class="token punctuation">:</span>
            <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Connection is OFF. Waiting for the receiver to reconnect..."</span><span class="token punctuation">)</span>

<span class="token keyword keyword-except">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Program interrupted by user."</span><span class="token punctuation">)</span>
<span class="token keyword keyword-finally">finally</span><span class="token punctuation">:</span>
    <span class="token comment"># 5. Stop the receiver to clean up resources</span>
    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Stopping receiver service..."</span><span class="token punctuation">)</span>
    receiver<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string">"Receiver service stopped."</span><span class="token punctuation">)</span>
</code></pre><hr>
<h2 id="lifecycle-methods-1">Lifecycle Methods </h2>
<p>These methods control the operational state of the receiver.</p>
<h3 id="__init__self-channels-int--16-sample_rate-int--500-duration-int--4-ip-str--19216841-port-int--8080"><code>__init__(self, channels: int = 16, sample_rate: int = 500, duration: int = 4, Ip: str = "192.168.4.1", port: int = 8080)</code> </h3>
<p>Initializes the TCP receiver's configuration. This method only sets up the object's state and does not initiate any network activity.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>channels</code> (<code>int</code>): The number of data channels to expect. Defaults to <code>16</code>.</li>
<li><code>sample_rate</code> (<code>int</code>): The sample rates of the received data. Defaults to <code>500</code>.</li>
<li><code>duration</code> (<code>int</code>): The duration in seconds of data to store in the buffer for each channel. Defaults to <code>4</code>.</li>
<li><code>Ip</code> (<code>str</code>): The IP address of the target device. Defaults to <code>"192.168.4.1"</code>.</li>
<li><code>port</code> (<code>int</code>): The TCP port on the target device. Defaults to <code>8080</code>.</li>
</ul>
</li>
</ul>
<h3 id="startself-1"><code>start(self)</code> </h3>
<p>Starts the background worker thread. The thread manages connection, data reception, and reconnection logic.</p>
<h3 id="stopself-2"><code>stop(self)</code> </h3>
<p>Stops the background worker thread and cleans up all resources, including the network socket. This method is thread-safe and blocks until the worker thread has terminated.</p>
<hr>
<h2 id="status--data-access-1">Status &amp; Data Access </h2>
<p>These methods provide thread-safe access to the receiver's current state and the data it has collected.</p>
<h3 id="is_connectedself---bool-1"><code>is_connected(self) -&gt; bool</code> </h3>
<p>Checks if the client is currently connected to the server.</p>
<ul>
<li><strong>Returns</strong>: <code>bool</code> - <code>True</code> if a connection is established, <code>False</code> otherwise.</li>
</ul>
<h3 id="get_dataself---listdequefloat-2"><code>get_data(self) -&gt; List[Deque[float]]</code> </h3>
<p>Returns a shallow copy of all channel data queues.</p>
<ul>
<li><strong>Returns</strong>: <code>List[Deque[float]]</code> - A list of deques. Each deque contains the buffered data for a single channel, converted to millivolts (mV).</li>
</ul>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>